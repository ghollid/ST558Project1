---
title: "Interacting with API's - Example with the Open Movie Database API"
author: "Grace Holliday"
date: "2023-06-11"
output: github_document
  toc: TRUE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library('httr')
library('jsonlite')
library('tidyverse')
```

This document is a vignette designed to introduce retrieving and manipulating
data from an API (Application Programming Interface). I will be interacting 
with the Open Movie Database API (OMDb).  I will build several functions 
comprised of a six endpoints and demonstrate some basic data manipulation. 

Endpoints include: Highest Grossing Movie in a given List of Movies,IMDb ID and plot, Movie Title and Year of Release, 
type (movie, series, episode) and Movie Title , plot(short or full) and Movie
Title, plot and type, or IMDB ID and Year of Release.

### Requirements

Packages necessary for interactions with the OMDb API/data cleaning and 
manipulation from the OMDb API:

1. **tidyverse**: A collection of R packages for data science,arguably most 
useful for data manipulation and cleaning.
2. **jsonlite**: A JSON parser and generator, optimized for statistical data 
and the web.  Notably useful for interacting with a web API.

### API Interaction Functions

#### Highest Grossing Movie
This function takes a vector of several Movie Titles and determines which movie was the highest grossing, along with the year of release.  It produces a
data frame ranking the movies from highest to lowest grossing.
```{r,echo=TRUE,warning=FALSE}
m <- c("Titanic","Iron Man","Avengers: Endgame","Dances with Wolves")
Gross <- function(Title){
    Title <- gsub(" ", "+", Title)
    url <- paste("https://www.omdbapi.com/?t=",Title,"&apikey=82725ca8",sep="")
    data <- GET(url)
    # converting raw data to character
    data = rawToChar(data$content)
    # converting character to json format
    jsondata = fromJSON(data)
    # Putting news title gross earnings, and year into R object
    tgy <- c(jsondata$Title,jsondata$BoxOffice,jsondata$Year)
    return(tgy)
}

HighGross <- function(Movies){
  x <- data.frame(matrix(NA,nrow=length(Movies),ncol=3))
  for(i in 1:length(Movies)){
      
     x[i,] <- Gross(Movies[i])
  }
  x <- x[order(x$X2,na.last=TRUE,decreasing=TRUE),]
  return(x)
  }


t <- HighGross(m)
t
```

### Data Manipulation

### Wrap-Up
